{"ast":null,"code":"var _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nimport { checkRendering } from '../../lib/utils.js';\nimport generateRanges from './generate-ranges.js';\nimport isFinite from 'lodash/isFinite';\nvar usage = 'Usage:\\nvar customPriceRanges = connectPriceRanges(function render(params, isFirstRendering) {\\n  // params = {\\n  //   items,\\n  //   refine,\\n  //   instantSearchInstance,\\n  //   widgetParams,\\n  // }\\n});\\nsearch.addWidget(\\n  customPriceRanges({\\n    attributeName,\\n  })\\n);\\nFull documentation available at https://community.algolia.com/instantsearch.js/v2/connectors/connectPriceRanges.html\\n';\n/**\n * @typedef {Object} PriceRangesItem\n * @property {number} [from] Lower bound of the price range.\n * @property {number} [to] Higher bound of the price range.\n * @property {string} url The URL for a single item in the price range.\n */\n\n/**\n * @typedef {Object} CustomPriceRangesWidgetOptions\n * @property {string} attributeName Name of the attribute for faceting.\n */\n\n/**\n * @typedef {Object} PriceRangesRenderingOptions\n * @property {PriceRangesItem[]} items The prices ranges to display.\n * @property {function(PriceRangesItem)} refine Selects or unselects a price range and trigger a search.\n * @property {Object} widgetParams All original `CustomPriceRangesWidgetOptions` forwarded to the `renderFn`.\n */\n\n/**\n * **PriceRanges** connector provides the logic to build a custom widget that will let\n * the user refine results based on price ranges.\n *\n * @type {Connector}\n * @param {function(PriceRangesRenderingOptions, boolean)} renderFn Rendering function for the custom **PriceRanges** widget.\n * @param {function} unmountFn Unmount function called when the widget is disposed.\n * @return {function(CustomPriceRangesWidgetOptions)} Re-usable widget factory for a custom **PriceRanges** widget.\n * @example\n * function getLabel(item) {\n *   var from = item.from;\n *   var to = item.to;\n *\n *   if (to === undefined) return '≥ $' + from;\n *   if (from === undefined) return '≤ $' + to;\n *   return '$' + from + ' - $' + to;\n * }\n *\n * // custom `renderFn` to render the custom PriceRanges widget\n * function renderFn(PriceRangesRenderingOptions, isFirstRendering) {\n *   if (isFirstRendering) {\n *     PriceRangesRenderingOptions.widgetParams.containerNode.html('<ul></ul>');\n *   }\n *\n *   PriceRangesRenderingOptions.widgetParams.containerNode\n *     .find('ul > li')\n *     .each(function() { $(this).off('click'); });\n *\n *   var list = PriceRangesRenderingOptions.items.map(function(item) {\n *     return '<li><a href=\"' + item.url + '\">' + getLabel(item) + '</a></li>';\n *   });\n *\n *   PriceRangesRenderingOptions.widgetParams.containerNode\n *     .find('ul')\n *     .html(list);\n *\n *   PriceRangesRenderingOptions.widgetParams.containerNode\n *     .find('li')\n *     .each(function(index) {\n *       $(this).on('click', function(event) {\n *         event.stopPropagation();\n *         event.preventDefault();\n *\n *         PriceRangesRenderingOptions.refine(\n *           PriceRangesRenderingOptions.items[index]\n *         );\n *       });\n *     });\n * }\n *\n * // connect `renderFn` to PriceRanges logic\n * var customPriceRanges = instantsearch.connectors.connectPriceRanges(renderFn);\n *\n * // mount widget on the page\n * search.addWidget(\n *   customPriceRanges({\n *     containerNode: $('#custom-price-ranges-container'),\n *     attributeName: 'price',\n *   })\n * );\n */\n\nexport default function connectPriceRanges(renderFn, unmountFn) {\n  checkRendering(renderFn, usage);\n  return function () {\n    var widgetParams = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var attributeName = widgetParams.attributeName;\n\n    if (!attributeName) {\n      throw new Error(usage);\n    }\n\n    return {\n      getConfiguration: function getConfiguration() {\n        return {\n          facets: [attributeName]\n        };\n      },\n      _generateRanges: function _generateRanges(results) {\n        var stats = results.getFacetStats(attributeName);\n        return generateRanges(stats);\n      },\n      _extractRefinedRange: function _extractRefinedRange(helper) {\n        var refinements = helper.getRefinements(attributeName);\n        var from = void 0;\n        var to = void 0;\n\n        if (refinements.length === 0) {\n          return [];\n        }\n\n        refinements.forEach(function (v) {\n          if (v.operator.indexOf('>') !== -1) {\n            from = Math.floor(v.value[0]);\n          } else if (v.operator.indexOf('<') !== -1) {\n            to = Math.ceil(v.value[0]);\n          }\n        });\n        return [{\n          from: from,\n          to: to,\n          isRefined: true\n        }];\n      },\n      _refine: function _refine(helper, _ref) {\n        var from = _ref.from,\n            to = _ref.to;\n\n        var facetValues = this._extractRefinedRange(helper);\n\n        helper.clearRefinements(attributeName);\n\n        if (facetValues.length === 0 || facetValues[0].from !== from || facetValues[0].to !== to) {\n          if (typeof from !== 'undefined') {\n            helper.addNumericRefinement(attributeName, '>=', Math.floor(from));\n          }\n\n          if (typeof to !== 'undefined') {\n            helper.addNumericRefinement(attributeName, '<=', Math.ceil(to));\n          }\n        }\n\n        helper.search();\n      },\n      init: function init(_ref2) {\n        var _this = this;\n\n        var helper = _ref2.helper,\n            instantSearchInstance = _ref2.instantSearchInstance;\n\n        this.refine = function (opts) {\n          _this._refine(helper, opts);\n        };\n\n        renderFn({\n          instantSearchInstance: instantSearchInstance,\n          items: [],\n          refine: this.refine,\n          widgetParams: widgetParams\n        }, true);\n      },\n      render: function render(_ref3) {\n        var results = _ref3.results,\n            helper = _ref3.helper,\n            state = _ref3.state,\n            createURL = _ref3.createURL,\n            instantSearchInstance = _ref3.instantSearchInstance;\n        var facetValues = void 0;\n\n        if (results && results.hits && results.hits.length > 0) {\n          facetValues = this._extractRefinedRange(helper);\n\n          if (facetValues.length === 0) {\n            facetValues = this._generateRanges(results);\n          }\n        } else {\n          facetValues = [];\n        }\n\n        facetValues.map(function (facetValue) {\n          var newState = state.clearRefinements(attributeName);\n\n          if (!facetValue.isRefined) {\n            if (facetValue.from !== undefined) {\n              newState = newState.addNumericRefinement(attributeName, '>=', Math.floor(facetValue.from));\n            }\n\n            if (facetValue.to !== undefined) {\n              newState = newState.addNumericRefinement(attributeName, '<=', Math.ceil(facetValue.to));\n            }\n          }\n\n          facetValue.url = createURL(newState);\n          return facetValue;\n        });\n        renderFn({\n          items: facetValues,\n          refine: this.refine,\n          widgetParams: widgetParams,\n          instantSearchInstance: instantSearchInstance\n        }, false);\n      },\n      dispose: function dispose(_ref4) {\n        var state = _ref4.state;\n        unmountFn();\n        var nextState = state.removeFacetRefinement(attributeName).removeFacet(attributeName);\n        return nextState;\n      },\n      getWidgetState: function getWidgetState(uiState, _ref5) {\n        var searchParameters = _ref5.searchParameters;\n\n        var _searchParameters$get = searchParameters.getNumericRefinements(attributeName),\n            _searchParameters$get2 = _searchParameters$get['>='],\n            min = _searchParameters$get2 === undefined ? '' : _searchParameters$get2,\n            _searchParameters$get3 = _searchParameters$get['<='],\n            max = _searchParameters$get3 === undefined ? '' : _searchParameters$get3;\n\n        if (min === '' && max === '' || uiState && uiState.priceRanges && uiState.priceRanges[attributeName] === min + ':' + max) {\n          return uiState;\n        }\n\n        return _extends({}, uiState, {\n          priceRanges: _extends({}, uiState.priceRanges, _defineProperty({}, attributeName, min + ':' + max))\n        });\n      },\n      getWidgetSearchParameters: function getWidgetSearchParameters(searchParameters, _ref6) {\n        var uiState = _ref6.uiState;\n        var value = uiState && uiState.priceRanges && uiState.priceRanges[attributeName];\n\n        if (!value || value.indexOf(':') === -1) {\n          return searchParameters;\n        }\n\n        var _searchParameters$get4 = searchParameters.getNumericRefinements(attributeName),\n            _searchParameters$get5 = _searchParameters$get4['>='],\n            previousMin = _searchParameters$get5 === undefined ? [NaN] : _searchParameters$get5,\n            _searchParameters$get6 = _searchParameters$get4['<='],\n            previousMax = _searchParameters$get6 === undefined ? [NaN] : _searchParameters$get6;\n\n        var clearedParams = searchParameters.clearRefinements(attributeName);\n\n        var _value$split$map = value.split(':').map(parseFloat),\n            _value$split$map2 = _slicedToArray(_value$split$map, 2),\n            lowerBound = _value$split$map2[0],\n            upperBound = _value$split$map2[1];\n\n        if (previousMin.includes(lowerBound) && previousMax.includes(upperBound)) {\n          return searchParameters;\n        }\n\n        if (isFinite(lowerBound)) {\n          clearedParams = clearedParams.addNumericRefinement(attributeName, '>=', lowerBound);\n        }\n\n        if (isFinite(upperBound)) {\n          clearedParams = clearedParams.addNumericRefinement(attributeName, '<=', upperBound);\n        }\n\n        return clearedParams;\n      }\n    };\n  };\n}","map":{"version":3,"sources":["/home/sow/Bureau/ProjetPerso/Gestion_School/embryo-angular/node_modules/instantsearch.js/es/connectors/price-ranges/connectPriceRanges.js"],"names":["_slicedToArray","sliceIterator","arr","i","_arr","_n","_d","_e","undefined","_i","Symbol","iterator","_s","next","done","push","value","length","err","Array","isArray","Object","TypeError","_extends","assign","target","arguments","source","key","prototype","hasOwnProperty","call","_defineProperty","obj","defineProperty","enumerable","configurable","writable","checkRendering","generateRanges","isFinite","usage","connectPriceRanges","renderFn","unmountFn","widgetParams","attributeName","Error","getConfiguration","facets","_generateRanges","results","stats","getFacetStats","_extractRefinedRange","helper","refinements","getRefinements","from","to","forEach","v","operator","indexOf","Math","floor","ceil","isRefined","_refine","_ref","facetValues","clearRefinements","addNumericRefinement","search","init","_ref2","_this","instantSearchInstance","refine","opts","items","render","_ref3","state","createURL","hits","map","facetValue","newState","url","dispose","_ref4","nextState","removeFacetRefinement","removeFacet","getWidgetState","uiState","_ref5","searchParameters","_searchParameters$get","getNumericRefinements","_searchParameters$get2","min","_searchParameters$get3","max","priceRanges","getWidgetSearchParameters","_ref6","_searchParameters$get4","_searchParameters$get5","previousMin","NaN","_searchParameters$get6","previousMax","clearedParams","_value$split$map","split","parseFloat","_value$split$map2","lowerBound","upperBound","includes"],"mappings":"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","sourcesContent":["var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { checkRendering } from '../../lib/utils.js';\nimport generateRanges from './generate-ranges.js';\n\nimport isFinite from 'lodash/isFinite';\n\nvar usage = 'Usage:\\nvar customPriceRanges = connectPriceRanges(function render(params, isFirstRendering) {\\n  // params = {\\n  //   items,\\n  //   refine,\\n  //   instantSearchInstance,\\n  //   widgetParams,\\n  // }\\n});\\nsearch.addWidget(\\n  customPriceRanges({\\n    attributeName,\\n  })\\n);\\nFull documentation available at https://community.algolia.com/instantsearch.js/v2/connectors/connectPriceRanges.html\\n';\n\n/**\n * @typedef {Object} PriceRangesItem\n * @property {number} [from] Lower bound of the price range.\n * @property {number} [to] Higher bound of the price range.\n * @property {string} url The URL for a single item in the price range.\n */\n\n/**\n * @typedef {Object} CustomPriceRangesWidgetOptions\n * @property {string} attributeName Name of the attribute for faceting.\n */\n\n/**\n * @typedef {Object} PriceRangesRenderingOptions\n * @property {PriceRangesItem[]} items The prices ranges to display.\n * @property {function(PriceRangesItem)} refine Selects or unselects a price range and trigger a search.\n * @property {Object} widgetParams All original `CustomPriceRangesWidgetOptions` forwarded to the `renderFn`.\n */\n\n/**\n * **PriceRanges** connector provides the logic to build a custom widget that will let\n * the user refine results based on price ranges.\n *\n * @type {Connector}\n * @param {function(PriceRangesRenderingOptions, boolean)} renderFn Rendering function for the custom **PriceRanges** widget.\n * @param {function} unmountFn Unmount function called when the widget is disposed.\n * @return {function(CustomPriceRangesWidgetOptions)} Re-usable widget factory for a custom **PriceRanges** widget.\n * @example\n * function getLabel(item) {\n *   var from = item.from;\n *   var to = item.to;\n *\n *   if (to === undefined) return '≥ $' + from;\n *   if (from === undefined) return '≤ $' + to;\n *   return '$' + from + ' - $' + to;\n * }\n *\n * // custom `renderFn` to render the custom PriceRanges widget\n * function renderFn(PriceRangesRenderingOptions, isFirstRendering) {\n *   if (isFirstRendering) {\n *     PriceRangesRenderingOptions.widgetParams.containerNode.html('<ul></ul>');\n *   }\n *\n *   PriceRangesRenderingOptions.widgetParams.containerNode\n *     .find('ul > li')\n *     .each(function() { $(this).off('click'); });\n *\n *   var list = PriceRangesRenderingOptions.items.map(function(item) {\n *     return '<li><a href=\"' + item.url + '\">' + getLabel(item) + '</a></li>';\n *   });\n *\n *   PriceRangesRenderingOptions.widgetParams.containerNode\n *     .find('ul')\n *     .html(list);\n *\n *   PriceRangesRenderingOptions.widgetParams.containerNode\n *     .find('li')\n *     .each(function(index) {\n *       $(this).on('click', function(event) {\n *         event.stopPropagation();\n *         event.preventDefault();\n *\n *         PriceRangesRenderingOptions.refine(\n *           PriceRangesRenderingOptions.items[index]\n *         );\n *       });\n *     });\n * }\n *\n * // connect `renderFn` to PriceRanges logic\n * var customPriceRanges = instantsearch.connectors.connectPriceRanges(renderFn);\n *\n * // mount widget on the page\n * search.addWidget(\n *   customPriceRanges({\n *     containerNode: $('#custom-price-ranges-container'),\n *     attributeName: 'price',\n *   })\n * );\n */\nexport default function connectPriceRanges(renderFn, unmountFn) {\n  checkRendering(renderFn, usage);\n\n  return function () {\n    var widgetParams = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var attributeName = widgetParams.attributeName;\n\n\n    if (!attributeName) {\n      throw new Error(usage);\n    }\n\n    return {\n      getConfiguration: function getConfiguration() {\n        return { facets: [attributeName] };\n      },\n      _generateRanges: function _generateRanges(results) {\n        var stats = results.getFacetStats(attributeName);\n        return generateRanges(stats);\n      },\n      _extractRefinedRange: function _extractRefinedRange(helper) {\n        var refinements = helper.getRefinements(attributeName);\n        var from = void 0;\n        var to = void 0;\n\n        if (refinements.length === 0) {\n          return [];\n        }\n\n        refinements.forEach(function (v) {\n          if (v.operator.indexOf('>') !== -1) {\n            from = Math.floor(v.value[0]);\n          } else if (v.operator.indexOf('<') !== -1) {\n            to = Math.ceil(v.value[0]);\n          }\n        });\n        return [{ from: from, to: to, isRefined: true }];\n      },\n      _refine: function _refine(helper, _ref) {\n        var from = _ref.from,\n            to = _ref.to;\n\n        var facetValues = this._extractRefinedRange(helper);\n\n        helper.clearRefinements(attributeName);\n        if (facetValues.length === 0 || facetValues[0].from !== from || facetValues[0].to !== to) {\n          if (typeof from !== 'undefined') {\n            helper.addNumericRefinement(attributeName, '>=', Math.floor(from));\n          }\n          if (typeof to !== 'undefined') {\n            helper.addNumericRefinement(attributeName, '<=', Math.ceil(to));\n          }\n        }\n\n        helper.search();\n      },\n      init: function init(_ref2) {\n        var _this = this;\n\n        var helper = _ref2.helper,\n            instantSearchInstance = _ref2.instantSearchInstance;\n\n        this.refine = function (opts) {\n          _this._refine(helper, opts);\n        };\n\n        renderFn({\n          instantSearchInstance: instantSearchInstance,\n          items: [],\n          refine: this.refine,\n          widgetParams: widgetParams\n        }, true);\n      },\n      render: function render(_ref3) {\n        var results = _ref3.results,\n            helper = _ref3.helper,\n            state = _ref3.state,\n            createURL = _ref3.createURL,\n            instantSearchInstance = _ref3.instantSearchInstance;\n\n        var facetValues = void 0;\n\n        if (results && results.hits && results.hits.length > 0) {\n          facetValues = this._extractRefinedRange(helper);\n\n          if (facetValues.length === 0) {\n            facetValues = this._generateRanges(results);\n          }\n        } else {\n          facetValues = [];\n        }\n\n        facetValues.map(function (facetValue) {\n          var newState = state.clearRefinements(attributeName);\n          if (!facetValue.isRefined) {\n            if (facetValue.from !== undefined) {\n              newState = newState.addNumericRefinement(attributeName, '>=', Math.floor(facetValue.from));\n            }\n            if (facetValue.to !== undefined) {\n              newState = newState.addNumericRefinement(attributeName, '<=', Math.ceil(facetValue.to));\n            }\n          }\n          facetValue.url = createURL(newState);\n          return facetValue;\n        });\n\n        renderFn({\n          items: facetValues,\n          refine: this.refine,\n          widgetParams: widgetParams,\n          instantSearchInstance: instantSearchInstance\n        }, false);\n      },\n      dispose: function dispose(_ref4) {\n        var state = _ref4.state;\n\n        unmountFn();\n\n        var nextState = state.removeFacetRefinement(attributeName).removeFacet(attributeName);\n\n        return nextState;\n      },\n      getWidgetState: function getWidgetState(uiState, _ref5) {\n        var searchParameters = _ref5.searchParameters;\n\n        var _searchParameters$get = searchParameters.getNumericRefinements(attributeName),\n            _searchParameters$get2 = _searchParameters$get['>='],\n            min = _searchParameters$get2 === undefined ? '' : _searchParameters$get2,\n            _searchParameters$get3 = _searchParameters$get['<='],\n            max = _searchParameters$get3 === undefined ? '' : _searchParameters$get3;\n\n        if (min === '' && max === '' || uiState && uiState.priceRanges && uiState.priceRanges[attributeName] === min + ':' + max) {\n          return uiState;\n        }\n\n        return _extends({}, uiState, {\n          priceRanges: _extends({}, uiState.priceRanges, _defineProperty({}, attributeName, min + ':' + max))\n        });\n      },\n      getWidgetSearchParameters: function getWidgetSearchParameters(searchParameters, _ref6) {\n        var uiState = _ref6.uiState;\n\n        var value = uiState && uiState.priceRanges && uiState.priceRanges[attributeName];\n\n        if (!value || value.indexOf(':') === -1) {\n          return searchParameters;\n        }\n\n        var _searchParameters$get4 = searchParameters.getNumericRefinements(attributeName),\n            _searchParameters$get5 = _searchParameters$get4['>='],\n            previousMin = _searchParameters$get5 === undefined ? [NaN] : _searchParameters$get5,\n            _searchParameters$get6 = _searchParameters$get4['<='],\n            previousMax = _searchParameters$get6 === undefined ? [NaN] : _searchParameters$get6;\n\n        var clearedParams = searchParameters.clearRefinements(attributeName);\n\n        var _value$split$map = value.split(':').map(parseFloat),\n            _value$split$map2 = _slicedToArray(_value$split$map, 2),\n            lowerBound = _value$split$map2[0],\n            upperBound = _value$split$map2[1];\n\n        if (previousMin.includes(lowerBound) && previousMax.includes(upperBound)) {\n          return searchParameters;\n        }\n\n        if (isFinite(lowerBound)) {\n          clearedParams = clearedParams.addNumericRefinement(attributeName, '>=', lowerBound);\n        }\n\n        if (isFinite(upperBound)) {\n          clearedParams = clearedParams.addNumericRefinement(attributeName, '<=', upperBound);\n        }\n\n        return clearedParams;\n      }\n    };\n  };\n}"]},"metadata":{},"sourceType":"module"}