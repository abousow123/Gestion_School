{"version":3,"file":"ngx-cache-core.js","sources":["ng://@ngx-cache/core/cache.ts","ng://@ngx-cache/core/cache.loader.ts","ng://@ngx-cache/core/models/return-type.ts","ng://@ngx-cache/core/cache.service.ts","ng://@ngx-cache/core/cache.module.ts","ng://@ngx-cache/core/util.ts","ng://@ngx-cache/core/cached.decorator.ts","ng://@ngx-cache/core/storage.ts"],"sourcesContent":["import { CacheValue } from './models/cache-value';\n\nexport abstract class Cache {\n  abstract get keys(): Array<string> | undefined;\n\n  abstract getItem(key: string): CacheValue | undefined;\n\n  abstract setItem(key: string, value: CacheValue): boolean;\n\n  abstract removeItem(key: string, wild: boolean): void;\n\n  abstract clear(): void;\n}\n","import { CacheSettings } from './models/cache-settings';\nimport { LifeSpan } from './models/life-span';\n\nexport abstract class CacheLoader {\n  abstract get key(): string;\n\n  abstract get lifeSpan(): LifeSpan;\n}\n\nexport class CacheStaticLoader implements CacheLoader {\n  get key(): string {\n    return this.providedSettings.key;\n  }\n\n  get lifeSpan(): LifeSpan {\n    return this.providedSettings.lifeSpan;\n  }\n\n  constructor(\n    private readonly providedSettings: CacheSettings = {\n      key: 'NGX_CACHE',\n      lifeSpan: {\n        expiry: Number.MAX_VALUE,\n        TTL: Number.MAX_VALUE\n      }\n    }\n  ) {}\n}\n","export enum ReturnType {\n  /**\n   * scalar\n   */\n  Scalar = 0,\n  /**\n   * observable\n   */\n  Observable = 10,\n  /**\n   * promise\n   */\n  Promise = 20\n}\n","import { Inject, Injectable, InjectionToken, Injector, PLATFORM_ID } from '@angular/core';\n\nimport { Cache } from './cache';\nimport { CacheLoader } from './cache.loader';\nimport { CacheValue } from './models/cache-value';\nimport { LifeSpan } from './models/life-span';\nimport { ReturnType } from './models/return-type';\n\nexport const CACHE = new InjectionToken<Cache>('CACHE');\n\n@Injectable()\nexport class CacheService {\n  private static instance: CacheService = undefined;\n\n  protected readonly cache: Cache;\n  protected readonly lifeSpan: LifeSpan;\n\n  static getInstance(loader?: CacheLoader, platformId?: any, injector?: Injector): CacheService {\n    return CacheService.instance;\n  }\n\n  static normalizeKey(key: string | number): string {\n    if (CacheService.validateKey(key)) {\n      throw new Error('Please provide a valid key to save in the CacheService');\n    }\n\n    return `${key}`;\n  }\n\n  private static validateKey(key: string | number): boolean {\n    return !key || typeof key === 'boolean' || Number.isNaN(key as number);\n  }\n\n  private static validateValue(value: CacheValue): boolean {\n    return value.lifeSpan.expiry && value.lifeSpan.expiry > Date.now();\n  }\n\n  constructor(readonly loader: CacheLoader, @Inject(PLATFORM_ID) private readonly platformId: any, private readonly injector: Injector) {\n    CacheService.instance = this;\n\n    this.cache = this.injector.get(CACHE);\n    this.lifeSpan = loader.lifeSpan;\n  }\n\n  get key(): string {\n    return this.loader.key;\n  }\n\n  has(key: string | number): boolean {\n    const normalized = CacheService.normalizeKey(key);\n\n    return this.cache.keys.indexOf(normalized) !== -1 && CacheService.validateValue(this.cache.getItem(normalized));\n  }\n\n  set(key: string | number, value: any, returnType: ReturnType = ReturnType.Scalar, lifeSpan?: LifeSpan): boolean {\n    const normalized = CacheService.normalizeKey(key);\n\n    return this.cache.setItem(normalized, {\n      data: value,\n      returnType,\n      lifeSpan: this.parseLifeSpan(lifeSpan ? lifeSpan : this.lifeSpan)\n    });\n  }\n\n  get(key: string | number): any {\n    const normalized = CacheService.normalizeKey(key);\n    const cached = this.cache.getItem(normalized);\n\n    if (Object.entries(cached).length !== 0 && cached.constructor === Object) {\n      if (CacheService.validateValue(cached)) {\n        return cached.data;\n      }\n\n      this.remove(normalized);\n    }\n\n    return undefined;\n  }\n\n  getWithMetadata(key: string | number): CacheValue | undefined {\n    const normalized = CacheService.normalizeKey(key);\n    const cached = this.cache.getItem(normalized);\n\n    if (Object.entries(cached).length !== 0 && cached.constructor === Object) {\n      if (CacheService.validateValue(cached)) {\n        return cached;\n      }\n\n      this.remove(key);\n    }\n\n    return undefined;\n  }\n\n  remove(key: string | number, wild = false): void {\n    const normalized = CacheService.normalizeKey(key);\n\n    this.cache.removeItem(normalized, wild);\n  }\n\n  clear(): void {\n    this.cache.clear();\n  }\n\n  dehydrate(): any {\n    const keys = this.cache.keys.length ? this.cache.keys : [];\n    const res = {};\n\n    keys.forEach((key: string) => {\n      res[key] = this.cache.getItem(key);\n    });\n\n    return res;\n  }\n\n  rehydrate(json: any): void {\n    Object.keys(json).forEach((key: string) => {\n      const normalized = CacheService.normalizeKey(key);\n      this.cache.setItem(normalized, json[normalized]);\n    });\n  }\n\n  private parseLifeSpan(lifeSpan: LifeSpan): LifeSpan {\n    return {\n      expiry: lifeSpan.expiry || (lifeSpan.TTL ? Date.now() + lifeSpan.TTL * 1000 : this.lifeSpan.expiry),\n      TTL: lifeSpan.TTL || this.lifeSpan.TTL\n    };\n  }\n}\n","import { InjectionToken, Injector, ModuleWithProviders, NgModule, Optional, PLATFORM_ID, SkipSelf } from '@angular/core';\n\nimport { CacheLoader, CacheStaticLoader } from './cache.loader';\nimport { CacheService } from './cache.service';\nimport { Storage } from './storage';\n\nexport const STORAGE = new InjectionToken<Storage>('STORAGE');\n\nexport const cacheFactory = () => new CacheStaticLoader();\n\nexport const cacheServiceFactory = (loader: CacheLoader, platformId: any, injector: Injector) =>\n  new CacheService(loader, platformId, injector);\n\n@NgModule()\nexport class CacheModule {\n  static forRoot(\n    configuredProvider: any = {\n      provide: CacheLoader,\n      useFactory: cacheFactory\n    }\n  ): ModuleWithProviders<CacheModule> {\n    return {\n      ngModule: CacheModule,\n      providers: [\n        configuredProvider,\n        {\n          provide: CacheService,\n          useFactory: cacheServiceFactory,\n          deps: [CacheLoader, PLATFORM_ID, Injector]\n        }\n      ]\n    };\n  }\n\n  constructor(@Optional() @SkipSelf() parentModule?: CacheModule) {\n    if (parentModule) {\n      throw new Error('CacheModule already loaded; import in root module only.');\n    }\n  }\n}\n","import { Observable } from 'rxjs';\n\nexport const isPromise = (obj: any): obj is Promise<any> => !!obj && typeof obj.then === 'function';\n\nexport const isObservable = (obj: any | Observable<any>): obj is Observable<any> => !!obj && typeof obj.subscribe === 'function';\n","import { Observable, of as observableOf } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { CacheService } from './cache.service';\nimport { ReturnType } from './models/return-type';\nimport { isObservable, isPromise } from './util';\n\n// tslint:disable-next-line\nexport function CacheKey(target: any, propertyKey: string, index: number): void {\n  const metadataKey = `__cache_${propertyKey}_keys`;\n\n  Array.isArray(target[metadataKey]) ? target[metadataKey].push(index) : (target[metadataKey] = [index]);\n}\n\n// tslint:disable-next-line\nexport function Cached(key: string): any | Observable<any> | Promise<any> {\n  // tslint:disable-next-line\n  return function(target: Function, propertyKey: string, descriptor: TypedPropertyDescriptor<any>): any | Observable<any> | Promise<any> {\n    const method: Function = descriptor.value;\n    descriptor.value = function(...args: Array<any>): any | Observable<any> | Promise<any> {\n      const cache = CacheService.getInstance();\n\n      const metadataKey = `__cache_${propertyKey}_keys`;\n      const indices = target[metadataKey];\n\n      let keyParts = '';\n\n      if (Array.isArray(indices)) {\n        for (let i = 0; i < args.length; i++) {\n          if (indices.indexOf(i) !== -1) {\n            keyParts = !keyParts ? String(args[i]) : `${keyParts}_${String(args[i])}`;\n          }\n        }\n      }\n\n      let cacheKey = !keyParts ? key : `${key}_${keyParts}`;\n\n      cacheKey = CacheService.normalizeKey(cacheKey);\n\n      // tslint:disable-next-line\n      if (!cache || !cacheKey) {\n        // tslint:disable-next-line\n        return method.apply(this, args);\n      }\n\n      if (cache.has(cacheKey)) {\n        const cached = cache.getWithMetadata(cacheKey);\n\n        if (cached && cached.data) {\n          switch (cached.returnType) {\n            case ReturnType.Observable:\n              return observableOf(cached.data);\n            case ReturnType.Promise:\n              return Promise.resolve(cached.data);\n            default:\n              return cached.data;\n          }\n        }\n      }\n\n      // tslint:disable-next-line\n      const value = method.apply(this, args);\n\n      if (isObservable(value)) {\n        return value.pipe(\n          map((res: any) => {\n            cache.set(cacheKey, res, ReturnType.Observable);\n\n            return res;\n          })\n        );\n      } else if (isPromise(value)) {\n        return (value).then((res: any) => {\n          cache.set(cacheKey, res, ReturnType.Promise);\n\n          return res;\n        });\n      }\n\n      cache.set(cacheKey, value);\n\n      return value;\n    };\n\n    return descriptor;\n  };\n}\n","import { EventEmitter } from 'events';\n\nexport abstract class Storage extends EventEmitter {\n  abstract length: number;\n  abstract keys: Array<string>;\n\n  abstract setItem(key: string, value: any): boolean;\n\n  abstract getItem(key: string): any;\n\n  abstract removeItem(key: string): boolean;\n\n  abstract key(index: number): string;\n\n  abstract clear(): boolean;\n}\n"],"names":["observableOf"],"mappings":"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"}