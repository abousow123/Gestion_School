!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("events")):"function"==typeof define&&define.amd?define("@ngx-cache/core",["exports","@angular/core","rxjs","rxjs/operators","events"],t):t(((e=e||self)["ngx-cache"]=e["ngx-cache"]||{},e["ngx-cache"].core={}),e.ng.core,e.rxjs,e.rxjs.operators,e.events)}(this,(function(e,t,r,n,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var a,c=function(){},u=function(){},s=function(){function e(e){void 0===e&&(e={key:"NGX_CACHE",lifeSpan:{expiry:Number.MAX_VALUE,TTL:Number.MAX_VALUE}}),this.providedSettings=e}return Object.defineProperty(e.prototype,"key",{get:function(){return this.providedSettings.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lifeSpan",{get:function(){return this.providedSettings.lifeSpan},enumerable:!0,configurable:!0}),e}();!function(e){e[e.Scalar=0]="Scalar",e[e.Observable=10]="Observable",e[e.Promise=20]="Promise"}(a||(a={}));var f=new t.InjectionToken("CACHE"),p=function(){function e(t,r,n){this.loader=t,this.platformId=r,this.injector=n,e.instance=this,this.cache=this.injector.get(f),this.lifeSpan=t.lifeSpan}return e.getInstance=function(t,r,n){return e.instance},e.normalizeKey=function(t){if(e.validateKey(t))throw new Error("Please provide a valid key to save in the CacheService");return""+t},e.validateKey=function(e){return!e||"boolean"==typeof e||Number.isNaN(e)},e.validateValue=function(e){return e.lifeSpan.expiry&&e.lifeSpan.expiry>Date.now()},Object.defineProperty(e.prototype,"key",{get:function(){return this.loader.key},enumerable:!0,configurable:!0}),e.prototype.has=function(t){var r=e.normalizeKey(t);return-1!==this.cache.keys.indexOf(r)&&e.validateValue(this.cache.getItem(r))},e.prototype.set=function(t,r,n,o){void 0===n&&(n=a.Scalar);var i=e.normalizeKey(t);return this.cache.setItem(i,{data:r,returnType:n,lifeSpan:this.parseLifeSpan(o||this.lifeSpan)})},e.prototype.get=function(t){var r=e.normalizeKey(t),n=this.cache.getItem(r);if(0!==Object.entries(n).length&&n.constructor===Object){if(e.validateValue(n))return n.data;this.remove(r)}},e.prototype.getWithMetadata=function(t){var r=e.normalizeKey(t),n=this.cache.getItem(r);if(0!==Object.entries(n).length&&n.constructor===Object){if(e.validateValue(n))return n;this.remove(t)}},e.prototype.remove=function(t,r){void 0===r&&(r=!1);var n=e.normalizeKey(t);this.cache.removeItem(n,r)},e.prototype.clear=function(){this.cache.clear()},e.prototype.dehydrate=function(){var e=this,t=this.cache.keys.length?this.cache.keys:[],r={};return t.forEach((function(t){r[t]=e.cache.getItem(t)})),r},e.prototype.rehydrate=function(t){var r=this;Object.keys(t).forEach((function(n){var o=e.normalizeKey(n);r.cache.setItem(o,t[o])}))},e.prototype.parseLifeSpan=function(e){return{expiry:e.expiry||(e.TTL?Date.now()+1e3*e.TTL:this.lifeSpan.expiry),TTL:e.TTL||this.lifeSpan.TTL}},e.instance=void 0,e.ɵfac=function(r){return new(r||e)(t.ɵɵinject(u),t.ɵɵinject(t.PLATFORM_ID),t.ɵɵinject(t.Injector))},e.ɵprov=t.ɵɵdefineInjectable({token:e,factory:e.ɵfac}),e}();t.ɵsetClassMetadata(p,[{type:t.Injectable}],(function(){return[{type:u},{type:void 0,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]},{type:t.Injector}]}),null);var l=new t.InjectionToken("STORAGE"),y=function(){return new s},h=function(e,t,r){return new p(e,t,r)},d=function(){function e(e){if(e)throw new Error("CacheModule already loaded; import in root module only.")}return e.forRoot=function(r){return void 0===r&&(r={provide:u,useFactory:y}),{ngModule:e,providers:[r,{provide:p,useFactory:h,deps:[u,t.PLATFORM_ID,t.Injector]}]}},e.ɵmod=t.ɵɵdefineNgModule({type:e}),e.ɵinj=t.ɵɵdefineInjector({factory:function(r){return new(r||e)(t.ɵɵinject(e,12))}}),e}();t.ɵsetClassMetadata(d,[{type:t.NgModule}],(function(){return[{type:d,decorators:[{type:t.Optional},{type:t.SkipSelf}]}]}),null);var v=function(e){return!!e&&"function"==typeof e.then},g=function(e){return!!e&&"function"==typeof e.subscribe};var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t}(o.EventEmitter);e.CACHE=f,e.Cache=c,e.CacheKey=function(e,t,r){var n="__cache_"+t+"_keys";Array.isArray(e[n])?e[n].push(r):e[n]=[r]},e.CacheLoader=u,e.CacheModule=d,e.CacheService=p,e.CacheStaticLoader=s,e.Cached=function(e){return function(t,o,i){var c=i.value;return i.value=function(){for(var i=[],u=0;u<arguments.length;u++)i[u]=arguments[u];var s=p.getInstance(),f="__cache_"+o+"_keys",l=t[f],y="";if(Array.isArray(l))for(var h=0;h<i.length;h++)-1!==l.indexOf(h)&&(y=y?y+"_"+String(i[h]):String(i[h]));var d=y?e+"_"+y:e;if(d=p.normalizeKey(d),!s||!d)return c.apply(this,i);if(s.has(d)){var m=s.getWithMetadata(d);if(m&&m.data)switch(m.returnType){case a.Observable:return r.of(m.data);case a.Promise:return Promise.resolve(m.data);default:return m.data}}var b=c.apply(this,i);return g(b)?b.pipe(n.map((function(e){return s.set(d,e,a.Observable),e}))):v(b)?b.then((function(e){return s.set(d,e,a.Promise),e})):(s.set(d,b),b)},i}},e.STORAGE=l,e.Storage=m,e.cacheFactory=y,e.cacheServiceFactory=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-cache-core.umd.min.js.map